# Московское метро — кратчайший путь

FastAPI-приложение для расчёта кратчайшего пути между двумя станциями метро Москвы.

## Данные

- База данных заполняется из [API HH Metro](https://api.hh.ru/metro/1).
- Таблица **stations** — станции (id, название, координаты, линия, порядок).
- Таблица **trips** — возможные поездки:
  - перемещения между соседними станциями на одной линии;
  - переходы: две станции считаются пересадочными, если расстояние между ними &lt; 0.001 (в градусах).

## Запуск через Docker Compose

```bash
docker-compose up --build
```

- API: http://localhost:8000  
- Документация: http://localhost:8000/docs  

При первом запуске создаются таблицы и выполняется загрузка данных из API.

## API

- `GET /health` — проверка работы сервиса.
- `POST /admin/refresh` — обновить данные из API (очистить и загрузить заново).
- `GET /stations?search=...&limit=100` — список станций (опционально поиск по названию).
- `GET /path?from_id=<id>&to_id=<id>` — кратчайший путь между станциями по их ID.

Пример: `/path?from_id=1.148&to_id=2.89` (от «Бульвар Рокоссовского» до «Новокузнецкая»).

## Визуализация графа

Скрипт строит интерактивный граф по тем же правилам, что и API (перегоны + переходы при расстоянии &lt; 0.001), чтобы проверять связи и визуально смотреть маршруты.

```bash
pip install pyvis   # если ещё не установлены (или pip install -r requirements.txt)
python scripts/visualize_metro.py -o metro_graph.html
```

Откройте `metro_graph.html` в браузере: **серые** линии — перегоны, **оранжевые** — переходы. Узлы окрашены по линиям метро (цвет из API).

Подсветка маршрута между двумя станциями:

```bash
python scripts/visualize_metro.py -o route.html --from-id 1.148 --to-id 2.89
```

Маршрут отобразится **жёлтыми** рёбрами и увеличенными узлами.

## Переменные окружения

- `DATABASE_URL` — строка подключения к PostgreSQL (по умолчанию `postgresql+asyncpg://metro:metro@db:5432/metro`).
- `TRANSFER_DISTANCE_THRESHOLD` — порог расстояния для перехода (по умолчанию `0.001`).
